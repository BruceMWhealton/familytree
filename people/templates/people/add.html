{% extends "people/base.html" %}
{% load static %}
{% block title %}Add Person{% endblock %}
{% block head %}
  {{ form.media }}
{% endblock %}

{% block content %}
  <h1 class="page-header">Add Person</h1>
  <div class="row">
    <div class="col-md-12">
      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {% for error in form.non_field_errors %}
            {{ error }}<br/>
          {% endfor %}
        </div>
      {% endif %}
      <form method="post" role="form">
        {% csrf_token %}

        <div class="well">
          <fieldset>
            <div class="row">
              <div class="form-group col-md-6{% if form.gender.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.gender.label }}</label>
                {% for radio in form.gender %}
                  <div class="radio-inline">
                    {{ radio.tag }} {{ radio.choice_label }}
                  </div>
                {% endfor %}
              </div>
              <div class="form-group col-md-6 text-right">
                <div class="checkbox-inline">
                  {{ form.blood_relative }} {{ form.blood_relative.label }}
                </div>
                <div class="checkbox-inline">
                  {{ form.deceased }} {{ form.deceased.label }}
                </div>
              </div>
            </div>
          </fieldset>

          <fieldset>
            <legend>Name</legend>
            <div class="row">
              <div class="form-group col-md-3{% if form.forename.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.forename.label }}</label>
                {{ form.forename }}
              </div>
              <div class="form-group col-md-5{% if form.middle_names.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.middle_names.label }}</label>
                {{ form.middle_names }}
              </div>
              <div class="form-group col-md-4{% if form.surname.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.surname.label }}</label>
                {{ form.surname }}
              </div>
            </div>
            <div class="row">
              <div class="form-group col-md-3{% if form.known_as.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.known_as.label }}</label>
                {{ form.known_as }}
              </div>
              <div class="form-group col-md-4 col-md-offset-5{% if form.maiden_name.errors %} has-error{% endif %}">
                <label class="control-label sr-only">{{ form.maiden_name.label }}</label>
                {{ form.maiden_name }}
              </div>
            </div>
          </fieldset>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="well">
              <fieldset>
                <legend>Birth</legend>
                <div class="row">
                  <div class="form-group col-sm-4{% if form.date_of_birth.errors %} has-error{% endif %}">
                    <label class="control-label sr-only">{{ form.date_of_birth.label }}</label>
                    {{ form.date_of_birth }}
                  </div>
                  <div class="form-group col-sm-8">
                    <label class="control-label sr-only">{{ form.birth_location.label }}</label>
                    {{ form.birth_location }}
                  </div>
                </div>
                <div class="row">
                  <div class="form-group col-sm-12{% if form.birth_reference.errors %} has-error{% endif %}">
                    <label class="control-label sr-only">{{ form.birth_reference.label }}</label>
                    {{ form.birth_reference }}
                  </div>
                </div>
              </fieldset>
            </div>
          </div>

          <div class="col-md-6">
            <div class="well">
              <fieldset id="death">
                <legend>Death</legend>
                <div class="row">
                  <div class="form-group col-sm-4{% if form.date_of_death.errors %} has-error{% endif %}">
                    <label class="control-label sr-only">{{ form.date_of_death.label }}</label>
                    {{ form.date_of_death }}
                  </div>
                  <div class="form-group col-sm-8">
                    <label class="control-label sr-only">{{ form.death_location.label }}</label>
                    {{ form.death_location }}
                  </div>
                </div>
                <div class="row">
                  <div class="form-group col-sm-12{% if form.death_reference.errors %} has-error{% endif %}">
                    <label class="control-label sr-only">{{ form.death_reference.label }}</label>
                    {{ form.death_reference }}
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
        </div>

        <div class="well">
          <fieldset>
            <legend>Parents</legend>
            <div class="row">
              <div class="form-group col-md-6">
                <label class="control-label sr-only">{{ form.mother.label }}</label>
                {{ form.mother }}
              </div>
              <div class="form-group col-md-6">
                <label class="control-label sr-only">{{ form.father.label }}</label>
                {{ form.father }}
              </div>
            </div>
          </fieldset>
        </div>

        <div class="well">
          <fieldset>
            <legend>Notes</legend>
            {{ form.notes }}
          </fieldset>
        </div>

        <div class="text-right">
          <button type="submit" class="btn btn-primary">Add Person</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    $(document).ready(function(){
      $('#id_birth_location').select2({templateResult: placeTemplate, templateSelection: placeTemplate, placeholder: 'Birthplace'});
      $('#id_death_location').select2({templateResult: placeTemplate, templateSelection: placeTemplate, placeholder: 'Location'});
      $('#id_mother').select2({templateResult: nameTemplate, templateSelection: nameTemplate, placeholder: 'Mother'});
      $('#id_father').select2({templateResult: nameTemplate, templateSelection: nameTemplate, placeholder: 'Father'});
      $('#id_deceased').on('change', function(){$('#death').prop('disabled', !$(this).is(':checked'));
                                                $('#id_death_location').prop('disabled', !$(this).is(':checked'));});
      $('.radio-inline').on('change', function(){$('#id_maiden_name').prop('disabled', !$('#id_gender_1').prop('checked'));});
      $('#id_maiden_name').prop('disabled', true);
    });
  </script>
{% endblock %}
