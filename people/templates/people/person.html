{% extends "people/base.html" %}
{% load static %}
{% load thumbnail %}
{% block title %}{{ person.name }}{% endblock %}

{% block content %}
  <h1 class="page-header">{{ person.name }}</h1>
  <div class="row">
    <div class="col-md-8">
      <table class="table table-condensed">
        <tr>
          <td>Born:</td>
          <td>{{ person.date_of_birth|default_if_none:"????" }}</td>
          <td class="text-right">
            {% if person.birth_location %}
              <img src="{% get_static_prefix %}people/images/flags/{{ person.birth_location.country.country_code }}.png"
                   alt="{{ person.birth_location.country }}" width="24" height="24" style="margin: -2px 5px;"/>
              {{ person.birth_location }}
            {% endif %}
          </td>
        </tr>
        {% if person.deceased %}
          <tr>
            <td>Died:</td>
            <td>{{ person.date_of_death|default_if_none:"????" }}</td>
            <td class="text-right">{% if person.age %}(aged {{ person.age }} years){% endif %}</td>
          </tr>
        {% elif person.age %}
          <tr><td>Age:</td><td colspan="2">{{ person.age }} years</td></tr>
        {% endif %}
      </table>
      <div role="tab-panel">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#notes" role="tab" data-toggle="tab">Notes</a>
          </li>
          <li role="presentation"{% if person.photos.count == 0 %} class="disabled"{% endif %}>
            <a href="#photos" role="tab"{% if person.photos.count > 0 %} data-toggle="tab"{% endif %}>Photos</a>
          </li>
          <li role="presentation"{% if person.documents.count == 0 %} class="disabled"{% endif %}>
            <a href="#documents" role="tab"{% if person.documents.count > 0 %} data-toggle="tab"{% endif %}>Documents</a>
          </li>
        </ul>
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="notes">
            <h3>Notes</h3>
            {{ person.notes|safe }}
          </div>
          {% if person.photos.count > 0 %}
            <div role="tabpanel" class="tab-pane" id="photos">
              <h3>Photos</h3>
              <div class="row">
                {% for photo in person.photos.all %}
                  <div class="col-md-3">
                    <a href="{{ MEDIA_URL }}{{ photo.image }}" class="thumbnail">
                      <img src="{% thumbnail photo.image 155x155 crop="scale" %}" alt="Thumbnail" />
                      <div class="caption text-center">
                        <small>
                          {{ photo.caption }}<br/>
                          <em class="text-muted">{{ photo.date|date:"F Y" }}</em>
                        </small>
                      </div>
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          {% if person.documents.count > 0 %}
            <div role="tabpanel" class="tab-pane" id="documents">
              <h3>Documents</h3>
              <ul>
                {% for document in person.documents.all %}
                  <li><a href="{{ MEDIA_URL }}{{ document.file }}">{{ document.title }}</a></li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Immediate Relatives</h3>
        </div>
        <div class="panel-body">
          <table class="table">
            {% if person.spouses %}
              <tr>
                <th>
                  {% ifequal person.gender 'F' %}Husband{{ person.spouses|length|pluralize }}{% endifequal %}
                  {% ifequal person.gender 'M' %}Wi{{ person.spouses|length|pluralize:"fe,ves"}}{% endifequal %}
                </th>
                <td>
                  {% for spouse in person.spouses %}
                    <a href="../{{ spouse.id }}/">{{ spouse.name }}</a><br/>
                  {% endfor %}
                </td>
              </tr>
            {% endif %}

            {% if person.children %}
              <tr>
                <th>Children</th>
                <td>
                  {% for child in person.children %}
                    <a href="../{{ child.id }}/">{{ child.name }}</a><br/>
                  {% endfor %}
                </td>
              </tr>
            {% endif %}

            {% if person.mother or person.father %}
              <tr>
                <th>Parents</th>
                <td>
                  {% if person.mother %}<a href="../{{ person.mother.id }}/">{{ person.mother.name }}</a><br/>{% endif %}
                  {% if person.father %}<a href="../{{ person.father.id }}/">{{ person.father.name }}</a>{% endif %}
                </td>
              </tr>
            {% endif %}

            {% if person.siblings %}
              <tr>
                <th>Siblings</th>
                <td>
                  {% for sibling in person.siblings %}
                    <a href="../{{ sibling.id }}/">{{ sibling.name }}</a><br/>
                  {% endfor %}
                </td>
              </tr>
            {% endif %}
          </table>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Extended Family</h3>
        </div>
        <div class="panel-body">
          <ul>
            {% if person.descendants %}
              <li><a href="./relatives/descendants/">All Descendants</a> <span class="badge">{{ person.descendants|length }}</span></li>
            {% endif %}
            {% if person.ancestors %}
              <li><a href="./relatives/ancestors/">All Ancestors</a> <span class="badge">{{ person.ancestors|length }}</span></li>
            {% endif %}
            <li><a href="./relatives/">All Blood Relatives</a> <span class="badge"></span></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      {% if person.tags.names %}
        <table class="table">
          <tr>
            <td>Tags:</td>
            <td class="text-right">
              {% for tag in person.tags.all %}
                <a href="{% url 'tag' tag.slug %}" class="label label-default">{{ tag.name }}</a>
              {% endfor %}
            </td>
          </tr>
        </table>
      {% endif %}
    </div>
  </div>
{% endblock %}

