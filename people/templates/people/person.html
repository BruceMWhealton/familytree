{% extends "people/base.html" %}
{% load static %}
{% load thumbnail %}
{% block title %}{{ person.name }}{% endblock %}

{% block content %}
  <h1 class="page-header">
    {{ person.name }}
    {% if relationship %}
      <small>{{ relationship }}</small>
    {% elif person == user.person %}
      <small>You</small>
    {% endif %}
    {% if user.is_staff %}
      <a href="{% url 'admin:people_person_change' person.id %}" class="pull-right btn btn-default">
        <span class="glyphicon glyphicon-pencil"></span> Edit
      </a>
    {% endif %}
  </h1>
  <div class="row">
    <div class="col-md-8">
      <table class="table table-condensed">
        <tr>
          <td>Born:</td>
          <td>{{ person.date_of_birth|default_if_none:"????" }}</td>
          <td class="text-right">
            {% if person.birth_location %}
              <img src="{% get_static_prefix %}people/images/flags/{{ person.birth_location.country.country_code }}.png"
                   alt="{{ person.birth_location.country }}" width="24" height="24" style="margin: -2px 5px;"/>
              <a href="{% url 'location' person.birth_location.id %}">{{ person.birth_location }}</a>
            {% endif %}
          </td>
        </tr>
        {% if person.deceased %}
          <tr>
            <td>Died:</td>
            <td>{{ person.date_of_death|default_if_none:"????" }}</td>
            <td class="text-right">{% if person.age %}(aged {{ person.age }} years){% endif %}</td>
          </tr>
        {% elif person.age %}
          <tr><td>Age:</td><td colspan="2">{{ person.age }} years</td></tr>
        {% endif %}
      </table>
      <h3>Notes</h3>
      {{ person.notes|safe }}
      {% if person.photos.count > 0 %}
        <br />
        <div class="row">
          {% for photo in person.photos.all %}
            <div class="col-md-3">
              <a href="{{ MEDIA_URL }}{{ photo.image }}" class="thumbnail">
                <img src="{% thumbnail photo.image 155x155 crop="scale" %}" alt="Thumbnail" />
                <div class="caption text-center">
                  <small>
                    {{ photo.caption }}<br/>
                    <em class="text-muted">{{ photo.date|date:"F Y" }}</em>
                  </small>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      {% if person.documents.count > 0 %}
        <br/>
        <table class="table table-condensed">
          <tr>
            <th>Document</th>
            <th class="text-right">Type</th>
            <th class="text-right">Size</th>
          </tr>
          {% for document in person.documents.all %}
            <tr>
              <td><a href="{{ MEDIA_URL }}{{ document.file }}">{{ document.title }}</a></td>
              <td class="text-right">{{ document.file_extension|upper }}</td>
              <td class="text-right">{{ document.file.size|filesizeformat }}</td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
    </div>
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Immediate Relatives</h3>
        </div>
        <div class="panel-body">
          <table class="table">
            {% if person.spouses %}
              <tr>
                <th>
                  {% ifequal person.gender 'F' %}Husband{{ person.spouses|length|pluralize }}{% endifequal %}
                  {% ifequal person.gender 'M' %}Wi{{ person.spouses|length|pluralize:"fe,ves"}}{% endifequal %}
                </th>
                <td>
                  {% for spouse, date, location in person.spouses %}
                    <a href="{% url 'person' spouse.id %}">{{ spouse.name }}</a>
                    {% if date %}
                      <span class="glyphicon glyphicon-info-sign pull-right" style="cursor: help;"
                            data-toggle="popover" data-placement="left" data-container="body"
                            data-content="{{ date }}{% if location %} at {{ location }}{% endif %}"></span>
                    {% endif %}
                    <br/>
                  {% endfor %}
                  <script>
                    $(function(){$('[data-toggle="popover"]').popover({trigger: 'hover'})});
                  </script>
                </td>
              </tr>
            {% endif %}

            {% if person.children %}
              <tr>
                <th>Children</th>
                <td>
                  {% for child in person.children %}
                    <a href="{% url 'person' child.id %}">{{ child.name }}</a><br/>
                  {% endfor %}
                </td>
              </tr>
            {% endif %}

            {% if person.mother or person.father %}
              <tr>
                <th>Parents</th>
                <td>
                  {% if person.mother %}<a href="{% url 'person' person.mother.id %}">{{ person.mother.name }}</a><br/>{% endif %}
                  {% if person.father %}<a href="{% url 'person' person.father.id %}">{{ person.father.name }}</a>{% endif %}
                </td>
              </tr>
            {% endif %}

            {% if person.siblings %}
              <tr>
                <th>Siblings</th>
                <td>
                  {% for sibling in person.siblings %}
                    <a href="{% url 'person' sibling.id %}">{{ sibling.name }}</a><br/>
                  {% endfor %}
                </td>
              </tr>
            {% endif %}
          </table>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Extended Family</h3>
        </div>
        <div class="panel-body">
          <ul>
            {% if person.descendants %}
              <li>
                <a href="{% url 'descendants' person.id %}">All Descendants</a>
                <span class="badge">{{ descendants }}</span>
                <span class="text-muted">&nbsp;|&nbsp;</span> <a href="{% url 'descendants_map' person.id %}">Map</a>
              </li>
            {% endif %}
            {% if person.ancestors %}
              <li>
                <a href="{% url 'ancestors' person.id %}">All Ancestors</a>
                <span class="badge">{{ ancestors }}</span>
                <span class="text-muted">&nbsp;|&nbsp;</span> <a href="{% url 'ancestors_map' person.id %}">Map</a>
                <span class="text-muted">&nbsp;|&nbsp;</span> <a href="{% url 'ring_chart' person.id %}">Chart</a>
                <span class="text-muted">&nbsp;|&nbsp;</span> <a href="{% url 'report' person.id %}">Report</a>
              </li>
            {% endif %}
            <li>
              <a href="{% url 'relatives' person.id %}">All Blood Relatives</a>
              <span class="text-muted">&nbsp;|&nbsp;</span> <a href="{% url 'relatives_map' person.id %}">Map</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      {% if person.tags.names %}
        <table class="table">
          <tr>
            <td>Tags:</td>
            <td class="text-right">
              {% for tag in person.tags.all %}
                <a href="{% url 'tag' tag.slug %}" class="label label-primary">{{ tag.name }}</a>
              {% endfor %}
            </td>
          </tr>
        </table>
      {% endif %}
    </div>
  </div>
{% endblock %}

